<div id="events-content" class="events-content">
    {% if message %}
    <div class="alert alert-{{ message_type }}">
        {{ message }}
    </div>
    {% endif %}
    
    <h2>Events Management</h2>
    
    <div class="month-navigation">
        <button class="btn btn-nav" 
                hx-get="{{ api_base_url }}/api/events/manage?month={{ prev_month }}" 
                hx-target="#events-content" 
                hx-swap="outerHTML">
            &laquo; Previous Month
        </button>
        <span class="current-month">{{ current_month_display }}</span>
        <button class="btn btn-nav" 
                hx-get="{{ api_base_url }}/api/events/manage?month={{ next_month }}" 
                hx-target="#events-content" 
                hx-swap="outerHTML">
            Next Month &raquo;
        </button>
    </div>
    
    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('pending-events')">Pending Events</button>
        <button class="tab-btn" onclick="showTab('approved-events')">Approved Events</button>
    </div>
    
    <div id="pending-events" class="tab-content active">
        <h3>Pending Events</h3>
        {% if pending_events %}
            <div class="events-list">
                <table class="events-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Location</th>
                            <th>URL</th>
                            <th>Source</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for event in pending_events %}
                        <tr class="event-row pending">
                            <td>{{ event.title }}</td>
                            <td>{{ event.date }}</td>
                            <td>{{ event.time }}</td>
                            <td>{{ event.location|default('N/A') }}</td>
                            <td><a href="{{ event.url }}" target="_blank">Link</a></td>
                            <td>{{ event.group|default('User Submitted') }}</td>
                            <td class="actions">
                                {% if not event.from_aggregator %}
                                <button class="btn btn-edit"
                                        hx-get="{{ api_base_url }}/api/events/edit-form/{{ event.id }}"
                                        hx-target="#edit-form-{{ event.id }}"
                                        hx-swap="innerHTML">
                                    Edit
                                </button>
                                {% endif %}
                                
                                <button class="btn btn-approve"
                                        hx-post="{{ api_base_url }}/api/events/approve/{{ event.id }}"
                                        hx-target="#events-content"
                                        hx-swap="outerHTML"
                                        hx-vals='{"month": "{{ event.month }}", "sort": "{{ event.sort }}"}'
                                        hx-confirm="Are you sure you want to approve this event?">
                                    Approve
                                </button>
                                
                                {% if not event.from_aggregator %}
                                <button class="btn btn-delete"
                                        hx-post="{{ api_base_url }}/api/events/delete/{{ event.id }}"
                                        hx-target="#events-content"
                                        hx-swap="outerHTML"
                                        hx-vals='{"month": "{{ event.month }}", "sort": "{{ event.sort }}"}'
                                        hx-confirm="Are you sure you want to delete this event? This action cannot be undone.">
                                    Delete
                                </button>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td colspan="7">
                                <div id="edit-form-{{ event.id }}" class="edit-form-container"></div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="no-events">
                <p>No pending events found.</p>
            </div>
        {% endif %}
    </div>
    
    <div id="approved-events" class="tab-content">
        <h3>Approved Events for {{ current_month_display }}</h3>
        {% if approved_events %}
            <div class="events-list">
                <table class="events-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Location</th>
                            <th>URL</th>
                            <th>Source</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for event in approved_events %}
                        <tr class="event-row approved">
                            <td>{{ event.title }}</td>
                            <td>{{ event.date }}</td>
                            <td>{{ event.time }}</td>
                            <td>{{ event.location|default('N/A') }}</td>
                            <td><a href="{{ event.url }}" target="_blank">Link</a></td>
                            <td>{{ event.group|default('User Submitted') }}</td>
                            <td class="actions">
                                {% if not event.from_aggregator %}
                                <button class="btn btn-edit"
                                        hx-get="{{ api_base_url }}/api/events/edit-form/{{ event.id }}"
                                        hx-target="#edit-form-{{ event.id }}"
                                        hx-swap="innerHTML">
                                    Edit
                                </button>
                                
                                <button class="btn btn-pause"
                                        hx-post="{{ api_base_url }}/api/events/pending/{{ event.id }}"
                                        hx-target="#events-content"
                                        hx-swap="outerHTML"
                                        hx-vals='{"month": "{{ event.month }}", "sort": "{{ event.sort }}"}'
                                        hx-confirm="Are you sure you want to set this event to pending?">
                                    Set Pending
                                </button>
                                
                                <button class="btn btn-delete"
                                        hx-post="{{ api_base_url }}/api/events/delete/{{ event.id }}"
                                        hx-target="#events-content"
                                        hx-swap="outerHTML"
                                        hx-vals='{"month": "{{ event.month }}", "sort": "{{ event.sort }}"}'
                                        hx-confirm="Are you sure you want to delete this event? This action cannot be undone.">
                                    Delete
                                </button>
                                {% else %}
                                <span class="locked-message">Locked (from aggregator)</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td colspan="7">
                                <div id="edit-form-{{ event.id }}" class="edit-form-container"></div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="no-events">
                <p>No approved events found for {{ current_month_display }}.</p>
            </div>
        {% endif %}
    </div>
</div>

<style>
    .events-content {
        margin-top: 20px;
    }
    
    .alert {
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 4px;
    }
    
    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    
    .alert-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
    
    .month-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        background-color: #f2f2f2;
        padding: 10px;
        border-radius: 4px;
    }
    
    .current-month {
        font-size: 18px;
        font-weight: bold;
    }
    
    .btn-nav {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .tabs {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 1px solid #ddd;
    }
    
    .tab-btn {
        padding: 10px 20px;
        background-color: #f8f9fa;
        border: none;
        border-radius: 4px 4px 0 0;
        cursor: pointer;
        margin-right: 5px;
    }
    
    .tab-btn.active {
        background-color: #007bff;
        color: white;
    }
    
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
    }
    
    .events-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    
    .events-table th, .events-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    
    .events-table th {
        background-color: #f2f2f2;
        font-weight: bold;
    }
    
    .event-row.pending {
        background-color: #fff3cd;
    }
    
    .event-row.approved {
        background-color: #d4edda;
    }
    
    .actions {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
    }
    
    .btn {
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        white-space: nowrap;
    }
    
    .btn-edit {
        background-color: #f0ad4e;
        color: white;
    }
    
    .btn-approve {
        background-color: #5cb85c;
        color: white;
    }
    
    .btn-delete {
        background-color: #d9534f;
        color: white;
    }
    
    .btn-pause {
        background-color: #5bc0de;
        color: white;
    }
    
    .edit-form-container {
        padding: 0;
    }
    
    .no-events {
        padding: 20px;
        text-align: center;
        background-color: #f9f9f9;
        border-radius: 4px;
        margin-top: 20px;
    }
    
    .locked-message {
        color: #6c757d;
        font-style: italic;
    }
</style>

<script>
    function showTab(tabId) {
        // Hide all tab contents
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Remove active class from all tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Show the selected tab content
        document.getElementById(tabId).classList.add('active');
        
        // Add active class to the clicked button
        document.querySelector(`.tab-btn[onclick="showTab('${tabId}')"]`).classList.add('active');
    }
</script>