<div id="groups-content" class="groups-content">
    {% if message %}
    <div class="alert alert-{{ message_type }}">
        {{ message }}
    </div>
    {% endif %}
    
    <div class="action-buttons">
        <a href="{{ api_base_url }}/api/groups/export-csv" class="btn btn-export">Export as CSV</a>
    </div>
    
    <!-- Pending Groups Section -->
    <h2>Pending Groups</h2>
    <div id="pending-groups-list" class="groups-list">
        {% set pending_groups = [] %}
        {% for group in groups %}
            {% if group.approval_status and 'PENDING' in group.approval_status.split('!')[-1] %}
                {% set _ = pending_groups.append(group) %}
            {% endif %}
        {% endfor %}
        
        {% if pending_groups %}
            <table class="groups-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Website</th>
                        <th>iCal URL</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for group in pending_groups %}
                    <tr class="group-row pending" id="group-{{ group.id }}">
                        <td>{{ group.name }}</td>
                        <td><a href="{{ group.website }}" target="_blank">{{ group.website }}</a></td>
                        <td>
                            {% if group.ical %}
                            <a href="{{ group.ical }}" target="_blank">View iCal</a>
                            {% else %}
                            No iCal
                            {% endif %}
                        </td>
                        <td class="actions">
                            <button class="btn btn-edit"
                                    hx-get="{{ api_base_url }}/api/groups/edit-form/{{ group.id }}"
                                    hx-target="#edit-form-{{ group.id }}"
                                    hx-swap="innerHTML">
                                Edit
                            </button>
                            
                            <button class="btn btn-approve"
                                    hx-post="{{ api_base_url }}/api/groups/approve/{{ group.id | replace('!', '') }}"
                                    hx-target="#groups-content"
                                    hx-swap="outerHTML"
                                    hx-confirm="Are you sure you want to approve this group?">
                                Approve
                            </button>
                            
                            <button class="btn btn-delete"
                                    hx-post="{{ api_base_url }}/api/groups/delete/{{ group.id | replace('!', '') }}"
                                    hx-target="#groups-content"
                                    hx-swap="outerHTML"
                                    hx-confirm="Are you sure you want to delete this group? This action cannot be undone.">
                                Delete
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <div id="edit-form-{{ group.id }}" class="edit-form-container"></div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="no-groups">
                <p>No pending groups found.</p>
            </div>
        {% endif %}
    </div>
    
    <!-- Approved Groups Section -->
    <h2>Approved Groups</h2>
    <div id="approved-groups-list" class="groups-list">
        {% set approved_groups = [] %}
        {% for group in groups %}
            {% if group.approval_status and 'APPROVED' in group.approval_status.split('!')[-1] %}
                {% set _ = approved_groups.append(group) %}
            {% endif %}
        {% endfor %}
        
        {% if approved_groups %}
            <table class="groups-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Website</th>
                        <th>iCal URL</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for group in approved_groups %}
                    <tr class="group-row approved" id="group-{{ group.id }}">
                        <td>{{ group.name }}</td>
                        <td><a href="{{ group.website }}" target="_blank">{{ group.website }}</a></td>
                        <td>
                            {% if group.ical %}
                            <a href="{{ group.ical }}" target="_blank">View iCal</a>
                            {% else %}
                            No iCal
                            {% endif %}
                        </td>
                        <td class="actions">
                            <button class="btn btn-edit"
                                    hx-get="{{ api_base_url }}/api/groups/edit-form/{{ group.id }}"
                                    hx-target="#edit-form-{{ group.id }}"
                                    hx-swap="innerHTML">
                                Edit
                            </button>
                            
                            <button class="btn btn-pause"
                                    hx-post="{{ api_base_url }}/api/groups/pending/{{ group.id | replace('!', '') }}"
                                    hx-target="#groups-content"
                                    hx-swap="outerHTML"
                                    hx-confirm="Are you sure you want to set this group to pending?">
                                Set Pending
                            </button>
                            
                            <button class="btn btn-delete"
                                    hx-post="{{ api_base_url }}/api/groups/delete/{{ group.id | replace('!', '') }}"
                                    hx-target="#groups-content"
                                    hx-swap="outerHTML"
                                    hx-confirm="Are you sure you want to delete this group? This action cannot be undone.">
                                Delete
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <div id="edit-form-{{ group.id }}" class="edit-form-container"></div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="no-groups">
                <p>No approved groups found.</p>
            </div>
        {% endif %}
    </div>
</div>

<style>
    .groups-content {
        margin-top: 20px;
    }
    
    .alert {
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 4px;
    }
    
    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    
    .alert-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
    
    .groups-list {
        margin-bottom: 30px;
    }
    
    .groups-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    
    .groups-table th, .groups-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    
    .groups-table th {
        background-color: #f2f2f2;
        font-weight: bold;
    }
    
    .group-row.pending {
        background-color: #fff3cd;
    }
    
    .group-row.approved {
        background-color: #d4edda;
    }
    
    .actions {
        display: flex;
        gap: 5px;
    }
    
    .btn {
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
    }
    
    .btn-edit {
        background-color: #f0ad4e;
        color: white;
    }
    
    .btn-approve {
        background-color: #5cb85c;
        color: white;
    }
    
    .btn-delete {
        background-color: #d9534f;
        color: white;
    }
    
    .btn-pause {
        background-color: #5bc0de;
        color: white;
    }
    
    .btn-export {
        background-color: #28a745;
        color: white;
        text-decoration: none;
        display: inline-block;
    }
    
    .action-buttons {
        margin-bottom: 15px;
    }
    
    .edit-form-container {
        padding: 0;
    }
    
    .no-groups {
        padding: 20px;
        text-align: center;
        background-color: #f9f9f9;
        border-radius: 4px;
        margin-top: 20px;
    }
    
    h2 {
        margin-top: 30px;
        padding-bottom: 10px;
        border-bottom: 2px solid #eee;
    }
</style>