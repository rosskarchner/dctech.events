<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events - Organize DC Tech Events</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.3.7/dist/amazon-cognito-identity.min.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>Organize DC Tech Events</h1>
            <nav id="main-nav"></nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2>Upcoming Events</h2>
            <p>Browse upcoming tech events in the DC area.</p>
        </div>

        <div id="events-list" class="grid">
            <div class="loading">Loading events...</div>
        </div>
    </main>

    <script src="/js/config.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/api.js"></script>
    <script>
        async function loadEvents() {
            const container = document.getElementById('events-list');

            try {
                const data = await window.api.listEvents();
                let events = data.events || [];

                // Filter to upcoming events only
                const now = new Date();
                events = events.filter(e => new Date(e.eventDate) >= now);

                // Sort by date
                events.sort((a, b) => new Date(a.eventDate) - new Date(b.eventDate));

                if (events.length === 0) {
                    container.innerHTML = '<div class="card">No upcoming events. <a href="/create-event.html">Create the first one!</a></div>';
                    return;
                }

                container.innerHTML = events.map(event => {
                    const date = new Date(event.eventDate);
                    const dateStr = date.toLocaleDateString();

                    return `
                        <div class="event-card">
                            <h3>${escapeHtml(event.title)}</h3>
                            <div class="event-date">
                                ${dateStr}${event.time ? ` at ${event.time}` : ''}
                            </div>
                            ${event.location ? `<div class="event-location">${escapeHtml(event.location)}</div>` : ''}
                            ${event.description ? `<p style="margin-top: 10px;">${escapeHtml(event.description)}</p>` : ''}
                            <div style="margin-top: 15px;">
                                <a href="/event.html?id=${event.eventId}" class="btn btn-primary">
                                    View Details
                                </a>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                container.innerHTML = `<div class="card"><div class="message error">Error loading events: ${error.message}</div></div>`;
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        document.addEventListener('DOMContentLoaded', loadEvents);
    </script>
</body>
</html>
