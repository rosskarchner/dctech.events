<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groups - Organize DC Tech Events</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.3.7/dist/amazon-cognito-identity.min.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>Organize DC Tech Events</h1>
            <nav id="main-nav"></nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2>DC Tech Groups</h2>
            <p>Browse and join tech groups in the DC area.</p>
        </div>

        <div id="groups-list" class="grid">
            <div class="loading">Loading groups...</div>
        </div>
    </main>

    <script src="/js/config.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/api.js"></script>
    <script>
        async function loadGroups() {
            const container = document.getElementById('groups-list');

            try {
                const data = await window.api.listGroups();
                const groups = data.groups || [];

                if (groups.length === 0) {
                    container.innerHTML = '<div class="card">No groups found. <a href="/create-group.html">Create the first one!</a></div>';
                    return;
                }

                container.innerHTML = groups.map(group => `
                    <div class="group-card">
                        <h3>${escapeHtml(group.name)}</h3>
                        ${group.description ? `<p>${escapeHtml(group.description)}</p>` : ''}
                        ${group.website ? `
                            <div class="group-website">
                                <a href="${escapeHtml(group.website)}" target="_blank" rel="noopener noreferrer">
                                    Website
                                </a>
                            </div>
                        ` : ''}
                        <div style="margin-top: 15px;">
                            <a href="/group.html?id=${group.groupId}" class="btn btn-primary">
                                View Details
                            </a>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                container.innerHTML = `<div class="card"><div class="message error">Error loading groups: ${error.message}</div></div>`;
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        document.addEventListener('DOMContentLoaded', loadGroups);
    </script>
</body>
</html>
