{% extends "base.html" %}

{% block title %}{{ site_name }}{% endblock %}


{% block content %}
<div class="home-container">

    <section class="events-section">
        <div id="subscribe">
            <div>
            Get this calendar in your inbox every week! <a href="{{ newsletter_signup_link }}" hx-get="{{ newsletter_signup_link }}" hx-target="#subscribe" hx-swap="innerHTML">Subscribe today</a>.
            </div>
            <div>You can also follow on <a href="https://bsky.app/profile/dctechevents.bsky.social">Bluesky</a> or <a href="https://dmv.community/@techevents">Mastodon</a></div>
        </div>

        {% if recently_added %}
        <div id="just-added-preview">
            Just added: 
            {% for event in recently_added %}
                {% if event.url %}<a href="{{ event.url }}">{{ event.title }}</a>{% else %}{{ event.title }}{% endif %}{% if event.date %}({{ event.date[5:7]|int }}/{{ event.date[8:10]|int }}){% endif %}{% if not loop.last %}, {% endif %}
            {% endfor %}
            and <a href="/just-added/">more</a>.
        </div>
        {% endif %}

    {% include "partials/events_by_day.html" %}

    </section>

    <section class="browse-section">
        <div class="browse-columns">
            <div class="browse-column">
                <h3>Browse by Month</h3>
                {% if upcoming_months %}
                    <ul class="month-list">
                    {% for month in upcoming_months %}
                        <li>
                            <a href="{{ month.url }}">{{ month.name }}</a>
                            <span class="count">({{ month.count }} event{% if month.count != 1 %}s{% endif %})</span>
                        </li>
                    {% endfor %}
                    </ul>
                {% else %}
                    <p>No upcoming months with events.</p>
                {% endif %}
            </div>
            
            <div class="browse-column">
                <h3>Browse by Category</h3>
                {% if categories_with_counts %}
                    <ul class="category-list">
                    {% for category in categories_with_counts %}
                        <li>
                            <a href="{{ category.url }}">{{ category.name }}</a>
                            <span class="count">({{ category.count }} event{% if category.count != 1 %}s{% endif %})</span>
                        </li>
                    {% endfor %}
                    </ul>
                {% else %}
                    <p>No categorized events.</p>
                {% endif %}
            </div>
        </div>
    </section>

</div>


{% endblock %}

{% block extra_head %}
<!-- Feed links -->
<link rel="alternate" type="application/rss+xml" title="{{ site_name }} RSS Feed" href="/events-feed.xml">
<link rel="alternate" type="text/calendar" title="{{ site_name }} iCal Feed" href="/events.ics">

<script src="https://unpkg.com/htmx.org@2.0.4"></script>

<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "{{ site_name }}",
  "description": "{{ tagline }}",
  "url": "{{ base_url }}"
}
</script>

{% if days %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "Upcoming Tech Events in DC",
  "description": "{{ tagline }}",
  "numberOfItems": {{ stats.upcoming_events }},
  "itemListElement": [
    {% set event_count = namespace(value=0) %}
    {% for day in days %}
      {% if day.has_events %}
        {% for time_slot in day.time_slots %}
          {% for event in time_slot.events %}
            {% if event_count.value < 20 %}
              {% if event_count.value > 0 %},{% endif %}
              {
                "@type": "ListItem",
                "position": {{ event_count.value + 1 }},
                "item": {
                  "@type": "Event",
                  "name": "{{ event.title | replace('"', '\\"') }}",
                  "url": "{{ event.url }}",
                  {% if event.time %}
                  "startDate": "{{ day.date }}T{{ event.time }}",
                  {% endif %}
                  {% if event.location %}
                  "location": {
                    "@type": "Place",
                    "name": "{{ event.location | replace('"', '\\"') }}"
                  },
                  {% endif %}
                  {% if event.group %}
                  "organizer": {
                    "@type": "Organization",
                    "name": "{{ event.group | replace('"', '\\"') }}"
                    {% if event.group_website %}
                    ,"url": "{{ event.group_website }}"
                    {% endif %}
                  },
                  {% endif %}
                  "eventAttendanceMode": "https://schema.org/MixedEventAttendanceMode"
                }
              }
              {% set event_count.value = event_count.value + 1 %}
            {% endif %}
          {% endfor %}
        {% endfor %}
      {% endif %}
    {% endfor %}
  ]
}
</script>
{% endif %}
{% endblock %}