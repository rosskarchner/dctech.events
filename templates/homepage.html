{% extends "base.html" %}

{% block title %}{{ site_name }}{% endblock %}


{% block content %}
<div class="home-container">

    <section class="events-section">
        <h2>{{ stats.upcoming_events }} Upcoming Events (<a href="{{ add_events_link }}">add more</a>)</h2>
        <div id="subscribe">
            <div>
            Get this calendar in your inbox every week! <a href="{{ newsletter_signup_link }}" hx-get="{{ newsletter_signup_link }}" hx-target="#subscribe" hx-swap="innerHTML">Subscribe today</a>.
            </div>
              
        </div>


    <{% include "partials/events_by_day.html" %}

</div>


{% endblock %}

{% block extra_head %}
    <!-- OpenGraph tags -->
    <meta property="og:title" content="{{ site_name }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ base_url }}">
    <meta property="og:description" content="{{ tagline }}">
    <meta property="og:site_name" content="{{ site_name }}">
    

<script src="https://unpkg.com/htmx.org@2.0.4"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('event-search');
    const eventsContainer = document.querySelector('.events-by-day');
    
    if (searchInput && eventsContainer) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            const dayContainers = eventsContainer.querySelectorAll('.day-container');
            
            dayContainers.forEach(dayContainer => {
                const timeSlots = dayContainer.querySelectorAll('.time-slot');
                let hasVisibleEvents = false;
                
                timeSlots.forEach(timeSlot => {
                    const events = timeSlot.querySelectorAll('.event');
                    let hasVisibleEventsInSlot = false;
                    
                    events.forEach(event => {
                        const title = event.querySelector('.p-name').textContent.toLowerCase();
                        const location = event.querySelector('.event-location');
                        const locationText = location ? location.textContent.toLowerCase() : '';
                        const group = event.querySelector('.p-organizer .p-name, .p-author');
                        const groupText = group ? group.textContent.toLowerCase() : '';
                        
                        const matches = title.includes(searchTerm) || 
                                      locationText.includes(searchTerm) || 
                                      groupText.includes(searchTerm);
                        
                        event.style.display = matches ? '' : 'none';
                        if (matches) hasVisibleEventsInSlot = true;
                    });
                    
                    timeSlot.style.display = hasVisibleEventsInSlot ? '' : 'none';
                    if (hasVisibleEventsInSlot) hasVisibleEvents = true;
                });
                
                dayContainer.style.display = hasVisibleEvents ? '' : 'none';
            });
        });
    }
});
</script>
{% endblock %}