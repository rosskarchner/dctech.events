<div id="admin-content" class="admin-container">
    <h2>Manage Events</h2>
    
    <div class="admin-nav">
        <button class="btn btn-primary" 
                hx-get="https://api.dctech.events/api/admin/events/pending" 
                hx-target="#admin-content"
                hx-swap="outerHTML">
            Pending Events
        </button>
        <button class="btn btn-primary" 
                hx-get="https://api.dctech.events/api/admin/events/approved" 
                hx-target="#admin-content"
                hx-swap="outerHTML">
            Approved Events
        </button>
        <button class="btn btn-primary" 
                hx-get="https://api.dctech.events/api/admin/events/all" 
                hx-target="#admin-content"
                hx-swap="outerHTML">
            All Events
        </button>
    </div>
    
    {{#show_pending_only}}
    <div class="filter-status">
        <p>Showing pending events</p>
    </div>
    
    {{#events}}
    <div class="event-card" id="event-{{id}}">
        <h3>{{title}}</h3>
        <div class="event-details">
            <p><strong>Date:</strong> {{date}}</p>
            <p><strong>Time:</strong> {{time}}</p>
            {{#group}}
            <p><strong>Group:</strong> {{group}}</p>
            {{/group}}
            {{#groupName}}
            <p><strong>Group:</strong> {{groupName}}</p>
            {{/groupName}}
            {{#sourceId}}
            <p><strong>Source:</strong> <span class="aggregated-tag">Aggregated</span></p>
            {{/sourceId}}
            <p><strong>URL:</strong> <a href="{{url}}" target="_blank">{{url}}</a></p>
            {{#location}}
            <p><strong>Location:</strong> {{location}}</p>
            {{/location}}
            <p><strong>Description:</strong> {{description}}</p>
            <p><strong>Status:</strong> {{status}}</p>
        </div>
        <div class="event-actions">
            <button class="btn btn-edit" 
                    hx-get="https://api.dctech.events/api/admin/events/{{id}}/edit" 
                    hx-target="#event-{{id}}"
                    hx-swap="innerHTML"
                    {{#sourceId}}disabled title="Aggregated events cannot be edited"{{/sourceId}}>
                Edit
            </button>
            
            <button class="btn btn-approve" 
                    hx-post="https://api.dctech.events/api/events/{{id}}/approve" 
                    hx-target="#event-{{id}}"
                    hx-swap="outerHTML"
                    hx-trigger="click"
                    hx-confirm="Are you sure you want to approve this event?">
                Approve
            </button>
            
            <button class="btn btn-delete" 
                    hx-delete="https://api.dctech.events/api/events/{{id}}" 
                    hx-target="#event-{{id}}"
                    hx-swap="outerHTML"
                    hx-trigger="click"
                    hx-confirm="Are you sure you want to delete this event? This action cannot be undone.">
                Delete
            </button>
        </div>
    </div>
    {{/events}}
    
    {{^events}}
    <div class="no-events">
        <p>No pending events found.</p>
    </div>
    {{/events}}
    {{/show_pending_only}}
    
    {{#show_approved_only}}
    <div class="filter-status">
        <p>Showing approved events</p>
    </div>
    
    {{#events}}
    <div class="event-card" id="event-{{id}}">
        <h3>{{title}}</h3>
        <div class="event-details">
            <p><strong>Date:</strong> {{date}}</p>
            <p><strong>Time:</strong> {{time}}</p>
            {{#group}}
            <p><strong>Group:</strong> {{group}}</p>
            {{/group}}
            {{#groupName}}
            <p><strong>Group:</strong> {{groupName}}</p>
            {{/groupName}}
            {{#sourceId}}
            <p><strong>Source:</strong> <span class="aggregated-tag">Aggregated</span></p>
            {{/sourceId}}
            <p><strong>URL:</strong> <a href="{{url}}" target="_blank">{{url}}</a></p>
            {{#location}}
            <p><strong>Location:</strong> {{location}}</p>
            {{/location}}
            <p><strong>Description:</strong> {{description}}</p>
            <p><strong>Status:</strong> {{status}}</p>
        </div>
        <div class="event-actions">
            <button class="btn btn-edit" 
                    hx-get="https://api.dctech.events/api/admin/events/{{id}}/edit" 
                    hx-target="#event-{{id}}"
                    hx-swap="innerHTML"
                    {{#sourceId}}disabled title="Aggregated events cannot be edited"{{/sourceId}}>
                Edit
            </button>
            
            <button class="btn btn-return-to-queue" 
                    hx-post="https://api.dctech.events/api/events/{{id}}/return-to-queue" 
                    hx-target="#event-{{id}}"
                    hx-swap="outerHTML"
                    hx-trigger="click"
                    hx-confirm="Are you sure you want to return this event to the pending queue?"
                    {{#sourceId}}disabled title="Aggregated events cannot be returned to queue"{{/sourceId}}>
                Return to Queue
            </button>
            
            <button class="btn btn-delete" 
                    hx-delete="https://api.dctech.events/api/events/{{id}}" 
                    hx-target="#event-{{id}}"
                    hx-swap="outerHTML"
                    hx-trigger="click"
                    hx-confirm="Are you sure you want to delete this event? This action cannot be undone.">
                Delete
            </button>
        </div>
    </div>
    {{/events}}
    
    {{^events}}
    <div class="no-events">
        <p>No approved events found.</p>
    </div>
    {{/events}}
    {{/show_approved_only}}
    
    {{#show_both_sections}}
    <!-- Pending Events Section -->
    <section class="admin-section">
        <h3>Pending Events</h3>
        
        {{#pending_events}}
        <div class="event-card" id="event-{{id}}">
            <h3>{{title}}</h3>
            <div class="event-details">
                <p><strong>Date:</strong> {{date}}</p>
                <p><strong>Time:</strong> {{time}}</p>
                {{#group}}
                <p><strong>Group:</strong> {{group}}</p>
                {{/group}}
                {{#groupName}}
                <p><strong>Group:</strong> {{groupName}}</p>
                {{/groupName}}
                {{#sourceId}}
                <p><strong>Source:</strong> <span class="aggregated-tag">Aggregated</span></p>
                {{/sourceId}}
                <p><strong>URL:</strong> <a href="{{url}}" target="_blank">{{url}}</a></p>
                {{#location}}
                <p><strong>Location:</strong> {{location}}</p>
                {{/location}}
                <p><strong>Description:</strong> {{description}}</p>
                <p><strong>Status:</strong> {{status}}</p>
            </div>
            <div class="event-actions">
                <button class="btn btn-edit" 
                        hx-get="https://api.dctech.events/api/admin/events/{{id}}/edit" 
                        hx-target="#event-{{id}}"
                        hx-swap="innerHTML"
                        {{#sourceId}}disabled title="Aggregated events cannot be edited"{{/sourceId}}>
                    Edit
                </button>
                
                <button class="btn btn-approve" 
                        hx-post="https://api.dctech.events/api/events/{{id}}/approve" 
                        hx-target="#event-{{id}}"
                        hx-swap="outerHTML"
                        hx-trigger="click"
                        hx-confirm="Are you sure you want to approve this event?">
                    Approve
                </button>
                
                <button class="btn btn-delete" 
                        hx-delete="https://api.dctech.events/api/events/{{id}}" 
                        hx-target="#event-{{id}}"
                        hx-swap="outerHTML"
                        hx-trigger="click"
                        hx-confirm="Are you sure you want to delete this event? This action cannot be undone.">
                    Delete
                </button>
            </div>
        </div>
        {{/pending_events}}
        
        {{^pending_events}}
        <div class="no-events">
            <p>No pending events found.</p>
        </div>
        {{/pending_events}}
    </section>
    
    <!-- Approved Events Section -->
    <section class="admin-section">
        <h3>Approved Events</h3>
        
        {{#approved_events}}
        <div class="event-card" id="event-{{id}}">
            <h3>{{title}}</h3>
            <div class="event-details">
                <p><strong>Date:</strong> {{date}}</p>
                <p><strong>Time:</strong> {{time}}</p>
                {{#group}}
                <p><strong>Group:</strong> {{group}}</p>
                {{/group}}
                {{#groupName}}
                <p><strong>Group:</strong> {{groupName}}</p>
                {{/groupName}}
                {{#sourceId}}
                <p><strong>Source:</strong> <span class="aggregated-tag">Aggregated</span></p>
                {{/sourceId}}
                <p><strong>URL:</strong> <a href="{{url}}" target="_blank">{{url}}</a></p>
                {{#location}}
                <p><strong>Location:</strong> {{location}}</p>
                {{/location}}
                <p><strong>Description:</strong> {{description}}</p>
                <p><strong>Status:</strong> {{status}}</p>
            </div>
            <div class="event-actions">
                <button class="btn btn-edit" 
                        hx-get="https://api.dctech.events/api/admin/events/{{id}}/edit" 
                        hx-target="#event-{{id}}"
                        hx-swap="innerHTML"
                        {{#sourceId}}disabled title="Aggregated events cannot be edited"{{/sourceId}}>
                    Edit
                </button>
                
                <button class="btn btn-return-to-queue" 
                        hx-post="https://api.dctech.events/api/events/{{id}}/return-to-queue" 
                        hx-target="#event-{{id}}"
                        hx-swap="outerHTML"
                        hx-trigger="click"
                        hx-confirm="Are you sure you want to return this event to the pending queue?"
                        {{#sourceId}}disabled title="Aggregated events cannot be returned to queue"{{/sourceId}}>
                    Return to Queue
                </button>
                
                <button class="btn btn-delete" 
                        hx-delete="https://api.dctech.events/api/events/{{id}}" 
                        hx-target="#event-{{id}}"
                        hx-swap="outerHTML"
                        hx-trigger="click"
                        hx-confirm="Are you sure you want to delete this event? This action cannot be undone.">
                    Delete
                </button>
            </div>
        </div>
        {{/approved_events}}
        
        {{^approved_events}}
        <div class="no-events">
            <p>No approved events found.</p>
        </div>
        {{/approved_events}}
    </section>
    {{/show_both_sections}}
    
    <script>
        document.addEventListener('htmx:afterSwap', function(event) {
            // Check if we need to refresh the events list
            if (event.detail.xhr && event.detail.xhr.getResponseHeader('HX-Trigger') === 'refreshEventsList') {
                // Get the current URL path to determine which list to refresh
                const path = window.location.pathname;
                let refreshUrl = 'https://api.dctech.events/api/admin/events';
                
                if (path.includes('/pending')) {
                    refreshUrl = 'https://api.dctech.events/api/admin/events/pending';
                } else if (path.includes('/approved')) {
                    refreshUrl = 'https://api.dctech.events/api/admin/events/approved';
                } else {
                    refreshUrl = 'https://api.dctech.events/api/admin/events/all';
                }
                
                // Refresh the events list
                htmx.ajax('GET', refreshUrl, {target: '#admin-content', swap: 'outerHTML'});
            }
        });
    </script>
    
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .admin-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .filter-status {
            margin-bottom: 20px;
            font-style: italic;
            color: #666;
        }
        
        .admin-section {
            margin-bottom: 40px;
        }
        
        .admin-section h3 {
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: #333;
        }
        
        .event-card {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .event-details {
            margin-bottom: 15px;
        }
        
        .event-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            border: none;
        }
        
        .btn-primary {
            background-color: #0066cc;
            color: white;
        }
        
        .btn-edit {
            background-color: #4caf50;
            color: white;
        }
        
        .btn-approve {
            background-color: #2196f3;
            color: white;
        }
        
        .btn-delete {
            background-color: #f44336;
            color: white;
        }
        
        .btn-return-to-queue {
            background-color: #ff9800;
            color: white;
        }
        
        .no-events {
            text-align: center;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        
        button[disabled] {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .aggregated-tag {
            background-color: #673ab7;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</div>
